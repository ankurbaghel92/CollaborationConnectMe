"use strict"

app.controller('JobController',['JobServices','$http','$rootScope','$location','$scope',function(JobServices,$http,$location,$scope,$rootScope)
{
	$scope.message = "Message from JobController"
		
		console.log("Starting ==>  JobController")


	var self = this;
	
	self.job = {id : '', tittle : '', qualification : '', description : '', status : '', date : ''};
	
	self.jobs = [];
	
	self.jobapplication = {id:'',username :'',jobid:'',date_applied:'',status:'',remarks:''}
	
	self.jobapplications = [] 
	
	
	var currentUser = $rootScope.currentUser;

	
	self.fetchAllJobs = function()
	{
		console.log("JobController ==> Starting fetchAllJobs function()")

		JobServices.fetchAllJobs().then
		(
				function(d)
				{
					console.log("JobController ==> Ending fetchAllJobs function()")

					self.jobs=d;
				},
				function(errResponse)
				{
					console.log("JobController ==> Ending fetchAllJobs function()")

					console.log("Error While Fetching all Jobs !!,.,!!,.,.")
				}
		)
	},
	
	
	self.fetchAllJobApplications = function()
	{
		console.log("JobController ==> Starting fetchAllJobs function()")

		JobServices.fetchAllJobApplications().then
		(
				function(d)
				{
					console.log("JobController ==> Ending fetchAllJobs function()")

					self.jobapplications=d;
				},
				function(errResponse)
				{
					console.log("Error While Fetching all Jobs !!,.,!!,.,.")
				}
		)
	}
	
	self.fetchAllJobs();
	
	self.fetchAllJobApplications();
	
	
	function applyForJob(jobId)
	{
		console.log("JobController ==> Starting fetchAllJobs function()")
		console.log("Logged In User Id:-  "+$rootScope.currentUser)
		var currentUser = $rootScope.currentUser;

	//	var currentUserId = $rootScope.currentUser.emailId
	//	console.log("Logged In User Id:-  "+$rootScope.currentUser.emailId)
		if (typeof currentUser == 'undefined')
			{
				alert("Please login to apply for the Job")
				//console.log("User Not Logged In So Not Able To Apply  ---->")
				return;
			}
		
		JobServices.applyForJob(jobId).then
		(
				function(d)
				{
					self.job = d
					alert(self.job.errorMessage)
				}
		)
	}
	
	self.applyForJob = applyForJob
	
	self.jobByID = function(id)
	{
		console.log("JobController ==> Starting fetchAllJobs function()")

			JobServices.jobById(id).then
			(
					function(d)
					{
						self.job = d;
					},
					function(errRespose)
					{
						console.log("Error While Fetching Jon ,.,!!,.,!!,.,")
					}
			)
	},
	
	
	self.createJob = function(job)
	{
		console.log("JobController ==> Starting fetchAllJobs function()")

		JobServices.createJob(job).then
		(
				function(d)
				{
					alert("Thankyou Job has been Posted Successfull")
				},
				function(errResponse)
				{
					console.log("Error while posting job,, please try again after sometime ,.,!!,.,!!,.,")
				}
		)
	}
	
	self.updateJob = function(job)
	{
		console.log("JobController ==> Starting fetchAllJobs function()")

		JobServices.updateJob(job).then
		(
				function(d)
				{
					alert("Thankyou Job has been udpate Successfully")
				},
				function(errResponse)
				{
					console.log("Error While Updating Job.,.,Please try again after sometime,.,!!,.,!!,.,")
				}
		)
	}
	
	
	self.submit =function()
	{
		console.log("JobController ==> Starting fetchAllJobs function()")

		self.createJob(self.job);
		self.reset();
	};
	
	
	self.reset = function()
	{
		console.log("JobController ==> Starting fetchAllJobs function()")

	self.job={
			
			Id :'',
			tittle :'',
			qualification : '',
			description :''
	}
	};
	
}])

