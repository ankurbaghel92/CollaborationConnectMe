'use strict'

app.controller('FriendController',['UserServices','FriendServices','$rootScope','$scope','$location',
                               function(UserServices,FriendServices,$rootScope,$scope,$location){
	
	$scope.friendmessage="Message From Friend Controller"
		
		console.log("Starting ==>  FriendController")

		
		var self = this;
		
		self.friend = {Id:'',emailId : '',friendUserName : '',status : '',IsOnline : '' };
		
		self.friends = [];
		
		
		self.user = {username:'',fname : '', lname : '', emailId : '', password : '', conPassword : '', mobile : '', role : '', isOnline : '', status : '', errorCode : '',
				 errorMessage : '', gender : '', reason : ''	};
	
	    self.users = [];
	    
		self.loggedInUser = $rootScope.currentUser.username

	    
	    self.fetchAllUsers = function(){
			console.log("FriendController ==> Starting fetchAllUsers function()")
			UserServices.fetchAllUsers().then
			    (
						function(d){
							self.users=d;
							console.log("FriendController ==> Ending fetchAllUsers function()")

						},
						function(errResponse)
						{
							console.error("Error  While Getting all the Users detials,.,.,.")
							console.log("FriendController ==> Ending fetchAllUsers function()")

						}
				)
		};//end of fetchAllUsers function()
	
		self.fetchAllUsers()

	
		

		 self.sendFriendRequest = function (friendUserName){

			console.log("FriendController ==> Starting sendFriendRequest function()")

			console.log(self.user.emailId)
			console.log(friendUserName)

			FriendServices.sendFriendRequest(friendUserName).then
			(
					function(d)
					{
						self.friend=d;
						alert(self.friend.errorMessage)
						console.log("FriendController ==> Ending sendFriendRequest function()")

					},
					function(errResponse)
					{
						console.error("Error  While Sending Friend Request")
						console.log("FriendController ==> Ending sendFriendRequest function()")

					}
			)
				
		},
		

		
		
		self.send = function(friendUserName)
		{
			console.log(friendUserName)
			console.log(self.user.username)
			self.sendFriendRequest(friendUserName)
		}
		
		self.acceptFriendRequest = function(friendUsername)
		{
			console.log("FriendController ==> Starting acceptFriendRequest function()")

			FriendServices.acceptFriendRequest(friendUsername).then
			(
					
					function(d)
					{
						self.friend=d;

						console.log("FriendController ==> Ending acceptFriendRequest function()")

						alert(self.friend.errorMessage)
					},
					
					function(errResponse)
					{
						
						console.error("Error  While Accepting Friend Request")
						console.log("FriendController ==> Ending acceptFriendRequest function()")

					}
					
			)
		}
		
		self.view = function(loggedInUser.username)
		{
			console.log(loggedInUsername)
			console.log(loggedInUsername)
			self.getMyFriendRequest(loggedInUsername)
		}

	self.getMyFriendRequest = function(loggedInUsername)
	{
		console.log("FriendController ==> Starting getMyFriendRequest function()")
		FriendServices.getMyFriendRequest(loggedInUsername).then
		(
				function(d)
				{
					self.friends=d;
					console.log("FriendController ==> Ending getMyFriendRequest function()")
					$location.path('/viewfriendrequest')

				},
				null
		)

	}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
}])